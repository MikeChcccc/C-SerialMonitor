# 串口调试工具

这是一个功能强大的串口调试工具，支持多编码格式、多种主题、定时发送、历史记录、预设管理以及蓝牙连接等高级功能。

## 功能特点

### 基础功能
- 串口参数配置（端口、波特率、数据位、校验位、停止位）
- 数据收发显示
- 十六进制收发模式
- 时间戳显示
- RTS/DTR信号控制
- 蓝牙设备连接与通信

### 增强功能
- **多主题支持**：内置8种主题颜色，可自由切换
- **多编码支持**：支持UTF-8、GBK、ASCII等多种编码格式
- **定时发送**：支持设置间隔时间自动发送数据
- **文件发送**：支持发送本地文件
- **发送历史**：记录发送过的数据，方便重复发送
- **预设管理**：支持添加、编辑、删除、保存和加载发送预设
- **文本搜索**：支持在接收区域搜索文本
- **自定义控件**：渐变背景、悬停按钮等视觉效果

## 项目结构

项目采用模块化设计，将功能分散到不同的模块中，提高代码的可维护性和复用性。

```
├── theme_manager.py       # 主题管理模块，负责主题切换和样式生成
├── serial_threads.py      # 串口线程模块，处理串口数据接收和文件发送
├── custom_widgets.py      # 自定义控件模块，包含渐变组框和悬停按钮
├── serial_config.py       # 串口配置模块，负责串口参数和编码配置
├── preset_manager.py      # 预设管理模块，处理发送预设的增删改查
├── bluetooth_manager.py   # 蓝牙管理模块，处理蓝牙设备扫描和连接
├── connection_manager.py  # 连接管理模块，处理各种连接类型（串口、蓝牙、TCP/UDP）
├── main_app.py            # 主应用模块，整合所有功能的主窗口
├── run.py                 # 程序入口文件
└── requirements.txt       # 项目依赖
```

## 安装指南

1. 确保已安装Python 3.6或更高版本
2. 安装依赖库
   ```
   pip install -r requirements.txt
   ```

### 蓝牙功能依赖安装

#### Windows

在Windows上，由于PyBluez的安装可能会遇到构建问题，建议使用以下方法之一：

##### 方法1：安装Bleak库（推荐）

```bash
pip install bleak
```

Bleak是一个跨平台的BLE（蓝牙低功耗）客户端库，支持Windows 10、Linux和macOS。程序已支持自动检测并使用Bleak。

##### 方法2：使用预编译的wheel文件

```bash
pip install https://github.com/pybluez/pybluez/releases/download/0.23/PyBluez-0.23-cp39-cp39-win_amd64.whl
```

注意：上述链接适用于Python 3.9 64位版本，如果您使用其他版本，请查找对应的wheel文件。

##### 方法3：从源码安装

```bash
git clone https://github.com/pybluez/pybluez
cd pybluez
pip install -e .
```

注意：程序现在支持自动检测并使用PyBluez或Bleak库，优先使用PyBluez，如果不可用则尝试使用Bleak。

无论使用哪种方法，您可能还需要：

1. 确保您的计算机有蓝牙适配器
2. 安装Visual C++构建工具
3. 安装Windows SDK

#### Linux

在Linux上，您需要安装一些系统依赖：

```bash
sudo apt-get install libbluetooth-dev
pip install pybluez
```

#### macOS

在macOS上，推荐使用PyBluez2：

```bash
pip install pybluez2
```

## 使用说明

1. 运行程序
   ```
   python run.py
   ```

### 串口连接

1. 选择串口端口和参数
2. 点击"打开串口"按钮连接串口
3. 在发送区域输入要发送的数据，点击"发送数据"按钮或使用Ctrl+Enter快捷键发送
4. 接收区域将显示接收到的数据
5. 可通过主题选择器切换界面颜色
6. 可通过复选框启用或禁用各种功能
7. 在预设选项卡中可以管理常用的发送内容

### 蓝牙连接

1. 在连接类型下拉菜单中选择"蓝牙"
2. 点击"扫描设备"按钮搜索附近的蓝牙设备
3. 从列表中选择要连接的设备
4. 点击"连接"按钮建立连接
5. 连接成功后，可以像使用串口一样发送和接收数据

## 功能详解

### 串口配置
- **串口号**：选择要连接的串口设备
- **波特率**：设置通信速率，支持常用的115200、9600等
- **数据位**：设置数据位数，支持5-8位
- **校验位**：设置校验方式，支持无校验、奇校验、偶校验等
- **停止位**：设置停止位数，支持1、1.5、2位
- **流控制**：设置流控制方式

### 蓝牙功能
- **设备扫描**：搜索附近可用的蓝牙设备
- **设备连接**：连接到选定的蓝牙设备
- **自动检测库**：自动检测并使用可用的蓝牙库（PyBluez或Bleak）
- **模拟模式**：当蓝牙库不可用时，自动切换到模拟模式

### 数据接收
- **十六进制显示**：以十六进制格式显示接收到的数据
- **显示时间戳**：每条数据前显示接收时间
- **自动换行**：超过一行时自动换行
- **接收编码**：选择接收数据的编码格式
- **错误处理**：选择处理编码错误的方式
- **文本搜索**：在接收区域中搜索特定文本

### 数据发送
- **十六进制发送**：以十六进制格式发送数据
- **自动添加换行符**：发送数据时自动添加回车换行
- **发送编码**：选择发送数据的编码格式
- **定时发送**：设置间隔时间自动发送数据
- **历史记录**：查看和重用之前发送过的数据
- **文件发送**：选择本地文件发送

### 预设管理
- **添加预设**：将当前发送内容保存为预设
- **编辑预设**：修改已有的预设内容
- **删除预设**：删除选中的预设
- **加载预设**：从文件加载预设列表
- **保存预设**：将预设列表保存到文件

## 快捷键
- **Ctrl+Enter**：发送当前编辑的数据
- **双击历史记录**：加载历史记录到发送框
- **双击预设**：加载预设到发送框

## 注意事项
- 使用前请确保已正确安装所需的依赖库
- 连接串口前请确保选择了正确的串口参数
- 发送大文件时可能会消耗较长时间
- 定时发送功能可能会增加系统负载

## 版本信息
- 版本：3.0
- 支持：Windows、Linux、macOS

## 常见问题
- Q: 无法找到串口设备怎么办？
  A: 点击"刷新端口"按钮，或检查USB连接和驱动是否正确安装。

- Q: 发送大文件时程序无响应？
  A: 这是正常现象，文件发送过程中请勿关闭程序，等待进度条完成。

- Q: 如何保存当前的串口参数？
  A: 目前版本暂不支持保存串口参数，每次打开程序需要重新设置。

- Q: 无法扫描到蓝牙设备怎么办？
  A: 确保蓝牙适配器已启用，目标设备已开启并处于可发现模式，且已正确安装蓝牙库。

- Q: 蓝牙连接失败怎么办？
  A: 确保设备地址正确，检查设备是否支持RFCOMM协议，尝试先在操作系统中与设备配对。
